<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholarship Game Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 4rem;
            font-weight: 700;
            color: #4a5568;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="preloader">LM</div>

    <div class="min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="grid grid-cols-12 gap-6">
            <aside class="col-span-12 lg:col-span-2">
                <div class="p-4 rounded-xl glass-panel sticky top-6">
                    <h1 class="text-2xl font-bold mb-6">Game Plan</h1>
                    <nav class="space-y-2">
                        <a href="#dashboard" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Dashboard</a>
                        <a href="#scholarships" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Scholarships</a>
                        <a href="#timeline" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Timeline</a>
                        <a href="#routine" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Daily Routine</a>
                        <a href="#documents" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Documents</a>
                        <a href="#contacts" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Contacts & Notes</a>
                        <a href="#updates" class="flex items-center p-2 rounded-lg hover:bg-white/50 nav-link">Live Updates</a>
                    </nav>
                </div>
            </aside>

            <main class="col-span-12 lg:col-span-10 space-y-6">
                <section id="dashboard" class="p-6 rounded-xl glass-panel content-section">
                    <h2 class="text-3xl font-bold mb-4">Dashboard</h2>
                    <div id="dashboard-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
                </section>

                <section id="scholarships" class="p-6 rounded-xl glass-panel content-section hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold">Scholarships</h2>
                        <button onclick="openModal('scholarship')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Add Scholarship</button>
                    </div>
                    <div id="scholarships-list" class="space-y-4"></div>
                </section>

                <section id="timeline" class="p-6 rounded-xl glass-panel content-section hidden">
                     <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold">Timeline</h2>
                        <button onclick="openModal('timeline')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Add Event</button>
                    </div>
                    <div id="timeline-list"></div>
                </section>
                
                <section id="routine" class="p-6 rounded-xl glass-panel content-section hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold">Daily Routine</h2>
                        <button onclick="openModal('routine')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Add Task</button>
                    </div>
                    <div id="routine-list" class="space-y-2"></div>
                </section>

                <section id="documents" class="p-6 rounded-xl glass-panel content-section hidden">
                     <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold">Document Checklist</h2>
                        <button onclick="openModal('document')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Add Document</button>
                    </div>
                    <div id="documents-list" class="space-y-2"></div>
                </section>

                <section id="contacts" class="p-6 rounded-xl glass-panel content-section hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold">Contacts & Notes</h2>
                        <button onclick="openModal('contact')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Add Contact</button>
                    </div>
                    <div id="contacts-list" class="space-y-4"></div>
                </section>

                <section id="updates" class="p-6 rounded-xl glass-panel content-section hidden">
                    <h2 class="text-3xl font-bold mb-4">Live Updates (Simulated)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="text-xl font-semibold mb-2">Scholarship News</h3>
                            <div id="scholarship-news" class="space-y-2"></div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-2">IELTS News</h3>
                            <div id="ielts-news" class="space-y-2"></div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="modal" class="modal-backdrop">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold mb-4"></h3>
            <form id="modal-form"></form>
            <div class="flex justify-end mt-4">
                <button onclick="closeModal()" class="bg-gray-300 px-4 py-2 rounded-lg mr-2">Cancel</button>
                <button id="save-button" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Save</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
    <script>
        // --- START: PASTE YOUR FIREBASE CONFIGURATION HERE ---
        const firebaseConfig = {
          apiKey: "YOUR_API_KEY",
          authDomain: "YOUR_AUTH_DOMAIN",
          projectId: "YOUR_PROJECT_ID",
          storageBucket: "YOUR_STORAGE_BUCKET",
          messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
          appId: "YOUR_APP_ID"
        };
        // --- END: PASTE YOUR FIREBASE CONFIGURATION HERE ---

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUser;
        let currentEditingId = null;

        // --- AUTHENTICATION ---
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                loadAllData();
            } else {
                auth.signInAnonymously().catch(error => {
                    console.error("Anonymous sign-in failed:", error);
                });
            }
        });

        // --- PRELOADER ---
        window.addEventListener('load', () => {
            document.querySelector('.preloader').style.display = 'none';
        });

        // --- NAVIGATION ---
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.content-section');

        navLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                
                sections.forEach(section => {
                    if (section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });

                navLinks.forEach(nav => nav.classList.remove('bg-white'));
                link.classList.add('bg-white');
            });
        });
        document.querySelector('.nav-link[href="#dashboard"]').click();
        
        // --- MODAL HANDLING ---
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalForm = document.getElementById('modal-form');
        const saveButton = document.getElementById('save-button');
        let currentCollection = '';

        const formStructures = {
            scholarship: `
                <input type="text" name="name" placeholder="Scholarship Name" class="w-full p-2 border rounded mb-2" required>
                <input type="text" name="university" placeholder="University" class="w-full p-2 border rounded mb-2">
                <input type="date" name="deadline" class="w-full p-2 border rounded mb-2">
                <select name="status" class="w-full p-2 border rounded mb-2">
                    <option value="Not Started">Not Started</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Submitted">Submitted</option>
                    <option value="Awarded">Awarded</option>
                    <option value="Rejected">Rejected</option>
                </select>
            `,
            timeline: `
                <input type="text" name="event" placeholder="Event Name" class="w-full p-2 border rounded mb-2" required>
                <input type="date" name="date" class="w-full p-2 border rounded mb-2" required>
                <textarea name="notes" placeholder="Notes" class="w-full p-2 border rounded mb-2"></textarea>
            `,
            routine: `
                <input type="text" name="task" placeholder="Task" class="w-full p-2 border rounded mb-2" required>
                <input type="time" name="time" class="w-full p-2 border rounded mb-2" required>
            `,
            document: `
                <input type="text" name="name" placeholder="Document Name" class="w-full p-2 border rounded mb-2" required>
                <select name="status" class="w-full p-2 border rounded mb-2">
                    <option value="Not Started">Not Started</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                </select>
            `,
            contact: `
                <input type="text" name="name" placeholder="Contact Name" class="w-full p-2 border rounded mb-2" required>
                <input type="email" name="email" placeholder="Email" class="w-full p-2 border rounded mb-2">
                <textarea name="notes" placeholder="Notes" class="w-full p-2 border rounded mb-2"></textarea>
            `
        };

        function openModal(type, id = null, data = {}) {
            currentCollection = type;
            currentEditingId = id;
            modalTitle.textContent = id ? `Edit ${type}` : `Add ${type}`;
            modalForm.innerHTML = formStructures[type];
            if (id) {
                Object.keys(data).forEach(key => {
                    const input = modalForm.querySelector(`[name=${key}]`);
                    if (input) input.value = data[key];
                });
            }
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
            modalForm.reset();
            currentEditingId = null;
        }

        saveButton.addEventListener('click', () => {
            const formData = new FormData(modalForm);
            const data = {};
            formData.forEach((value, key) => { data[key] = value });

            if (currentEditingId) {
                // Update
                db.collection('users').doc(currentUser.uid).collection(currentCollection).doc(currentEditingId).update(data)
                    .then(closeModal)
                    .catch(e => console.error("Error updating document: ", e));
            } else {
                // Add new
                 db.collection('users').doc(currentUser.uid).collection(currentCollection).add(data)
                    .then(closeModal)
                    .catch(e => console.error("Error adding document: ", e));
            }
        });
        
        // --- DATA LOADING & RENDERING ---
        function loadAllData() {
            if (!currentUser) return;
            loadCollection('scholarships', renderScholarships, 'deadline');
            loadCollection('timeline', renderTimeline, 'date');
            loadCollection('routine', renderRoutine, 'time');
            loadCollection('documents', renderDocuments, 'name');
            loadCollection('contacts', renderContacts, 'name');
            setupDashboardListener();
        }

        function loadCollection(collectionName, renderFunction, orderByField) {
            db.collection('users').doc(currentUser.uid).collection(collectionName).orderBy(orderByField)
              .onSnapshot(snapshot => {
                  const items = [];
                  snapshot.forEach(doc => items.push({ id: doc.id, ...doc.data() }));
                  renderFunction(items);
              });
        }
        
        function setupDashboardListener() {
             const collections = ['scholarships', 'timeline', 'routine', 'documents'];
             collections.forEach(collectionName => {
                 db.collection('users').doc(currentUser.uid).collection(collectionName)
                   .onSnapshot(() => {
                       Promise.all([
                           db.collection('users').doc(currentUser.uid).collection('scholarships').get(),
                           db.collection('users').doc(currentUser.uid).collection('timeline').get(),
                           db.collection('users').doc(currentUser.uid).collection('documents').get()
                       ]).then(([scholarships, timeline, documents]) => {
                           renderDashboard(
                               scholarships.docs.map(d => d.data()),
                               timeline.docs.map(d => d.data()),
                               documents.docs.map(d => d.data())
                           );
                       });
                   });
             });
        }

        function renderDashboard(scholarships, timeline, documents) {
            const dashboardContent = document.getElementById('dashboard-content');
            
            const totalScholarships = scholarships.length;
            const submitted = scholarships.filter(s => s.status === 'Submitted').length;
            
            const upcomingEvent = timeline
                .filter(t => new Date(t.date) >= new Date())
                .sort((a,b) => new Date(a.date) - new Date(b.date))[0];
            
            const docsCompleted = documents.filter(d => d.status === 'Completed').length;
            const totalDocs = documents.length;

            dashboardContent.innerHTML = `
                <div class="p-4 bg-white/50 rounded-lg">
                    <h3 class="font-semibold text-gray-500">Total Scholarships</h3>
                    <p class="text-3xl font-bold">${totalScholarships}</p>
                </div>
                <div class="p-4 bg-white/50 rounded-lg">
                    <h3 class="font-semibold text-gray-500">Submitted Applications</h3>
                    <p class="text-3xl font-bold">${submitted}</p>
                </div>
                <div class="p-4 bg-white/50 rounded-lg">
                    <h3 class="font-semibold text-gray-500">Upcoming Deadline</h3>
                    <p class="text-lg font-bold">${upcomingEvent ? upcomingEvent.event : 'None'}</p>
                    <p class="text-gray-600">${upcomingEvent ? new Date(upcomingEvent.date).toLocaleDateString() : ''}</p>
                </div>
                <div class="p-4 bg-white/50 rounded-lg">
                    <h3 class="font-semibold text-gray-500">Documents Progress</h3>
                    <p class="text-3xl font-bold">${totalDocs > 0 ? Math.round((docsCompleted/totalDocs)*100) : 0}%</p>
                    <p class="text-gray-600">${docsCompleted} of ${totalDocs} completed</p>
                </div>
            `;
        }

        function renderScholarships(items) {
            const list = document.getElementById('scholarships-list');
            list.innerHTML = items.map(item => `
                <div class="p-4 bg-white/50 rounded-lg flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-lg">${item.name}</h4>
                        <p class="text-gray-600">${item.university} - Deadline: ${item.deadline}</p>
                        <span class="text-sm font-semibold py-1 px-2 rounded-full bg-blue-200 text-blue-800">${item.status}</span>
                    </div>
                    <div>
                        <button onclick="openModal('scholarship', '${item.id}', ${JSON.stringify(item).replace(/"/g, "'")})" class="text-blue-500 mr-2">Edit</button>
                        <button onclick="deleteItem('scholarships', '${item.id}')" class="text-red-500">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function renderTimeline(items) {
            const list = document.getElementById('timeline-list');
            list.innerHTML = items.map(item => `
                <div class="border-l-4 pl-4 py-2 border-blue-500 mb-4">
                    <p class="font-semibold">${item.event} - ${new Date(item.date).toLocaleDateString()}</p>
                    <p class="text-sm text-gray-600">${item.notes || ''}</p>
                     <div class="mt-1">
                        <button onclick="openModal('timeline', '${item.id}', ${JSON.stringify(item).replace(/"/g, "'")})" class="text-blue-500 text-xs mr-2">Edit</button>
                        <button onclick="deleteItem('timeline', '${item.id}')" class="text-red-500 text-xs">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function renderRoutine(items) {
            const list = document.getElementById('routine-list');
            list.innerHTML = items.map(item => `
                <div class="p-2 bg-white/50 rounded-lg flex justify-between items-center">
                    <span><strong>${item.time}</strong> - ${item.task}</span>
                     <div>
                        <button onclick="openModal('routine', '${item.id}', ${JSON.stringify(item).replace(/"/g, "'")})" class="text-blue-500 mr-2">Edit</button>
                        <button onclick="deleteItem('routine', '${item.id}')" class="text-red-500">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function renderDocuments(items) {
            const list = document.getElementById('documents-list');
            list.innerHTML = items.map(item => `
                 <div class="p-2 bg-white/50 rounded-lg flex justify-between items-center">
                    <span>${item.name} - <span class="text-sm font-semibold">${item.status}</span></span>
                     <div>
                        <button onclick="openModal('document', '${item.id}', ${JSON.stringify(item).replace(/"/g, "'")})" class="text-blue-500 mr-2">Edit</button>
                        <button onclick="deleteItem('documents', '${item.id}')" class="text-red-500">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function renderContacts(items) {
            const list = document.getElementById('contacts-list');
            list.innerHTML = items.map(item => `
                 <div class="p-4 bg-white/50 rounded-lg">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold text-lg">${item.name}</h4>
                        <div>
                            <button onclick="openModal('contact', '${item.id}', ${JSON.stringify(item).replace(/"/g, "'")})" class="text-blue-500 mr-2">Edit</button>
                            <button onclick="deleteItem('contacts', '${item.id}')" class="text-red-500">Delete</button>
                        </div>
                    </div>
                    <p class="text-gray-600">${item.email || ''}</p>
                    <p class="mt-2 text-sm">${item.notes || ''}</p>
                </div>
            `).join('');
        }
        
        function deleteItem(collectionName, id) {
            if (confirm('Are you sure you want to delete this item?')) {
                db.collection('users').doc(currentUser.uid).collection(collectionName).doc(id).delete()
                    .catch(e => console.error("Error deleting document: ", e));
            }
        }
        
        // --- NOTIFICATIONS ---
        function checkRoutinesForNotifications() {
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            } else {
                 db.collection('users').doc(currentUser.uid).collection('routine').get().then(snapshot => {
                     snapshot.forEach(doc => {
                         const task = doc.data();
                         const [hours, minutes] = task.time.split(':');
                         const now = new Date();
                         const taskTime = new Date();
                         taskTime.setHours(hours, minutes, 0, 0);

                         if (taskTime.getHours() === now.getHours() && taskTime.getMinutes() === now.getMinutes()) {
                             new Notification('Routine Reminder', { body: `It's time for: ${task.task}` });
                         }
                     });
                 });
            }
        }
        
        setInterval(checkRoutinesForNotifications, 60000); // Check every minute
        
        // --- LIVE UPDATES (SIMULATED) ---
        function simulateLiveUpdates() {
            const scholarshipNews = document.getElementById('scholarship-news');
            const ieltsNews = document.getElementById('ielts-news');
            
            const sNews = [
                "Chevening Scholarship deadline extended to Nov 15th.",
                "Fulbright Program now accepting applications for 2026.",
                "New STEM scholarship announced by Google."
            ];
            const iNews = [
                "IELTS introduces one-skill retake option.",
                "Test fees to increase by 5% next quarter.",
                "New testing centers open in several cities."
            ];

            scholarshipNews.innerHTML = sNews.map(n => `<p class="text-sm p-2 bg-white/50 rounded">${n}</p>`).join('');
            ieltsNews.innerHTML = iNews.map(n => `<p class="text-sm p-2 bg-white/50 rounded">${n}</p>`).join('');
        }
        
        simulateLiveUpdates();
    </script>
</body>
</html>
